<!-- AI Analysis Modal -->
<div id="aiAnalysisModal" class="ai-modal-backdrop">
  <div class="ai-modal">
    <!-- Modal Header -->
    <div class="ai-modal-header">
      <div class="ai-header-title">
        <div class="ai-icon-wrapper">
          <i class="fas fa-brain"></i>
        </div>
        <div class="ai-title-content">
          <h2>Cegid Business Insights</h2>
          <p>Alert Deep Dive</p>
        </div>
      </div>
    </div>

    <!-- Modal Body -->
    <div class="ai-modal-body" id="ai-modal-body">
      <div id="aiConversation" class="ai-conversation">
        <!-- Initial greeting -->
        <div class="ai-message" id="greeting" style="display: none;">
          <div class="ai-avatar">
            <i class="fas fa-robot"></i>
          </div>
          <div class="ai-content">
            <div class="ai-bubble">
              <p>Let's analyze this alert:</p>
            </div>
            <div class="ai-alert">
              <p><i class="fas fa-triangle-exclamation"></i>
                <span>Wheat Price Surge Alert</span>
              </p>
              <p class="mt-1">
                <span>A <em>Barlia hordei</em> infestation threatens 63% of wheat crops in Ukraine.
                This is causing an 18-22% increase in wheat prices and increased volatility for the next 90 days.
                Impact analysis in progress.</span>
              </p>
            </div>
          </div>
        </div>

        <!-- Chart loading and display -->
        <div class="ai-message" id="chartMessage" style="display: none;">
          <div class="ai-avatar">
            <i class="fas fa-chart-line"></i>
          </div>
          <div class="ai-content">
            <div class="ai-bubble ai-loading" id="chartLoading" style="display: none;">
              <div class="ai-spinner"></div>
              <p>Checking Wheat price history...</p>
            </div>
            
            <div id="chartContainer" style="display: none;">
              <div class="ai-chart-container">
                <div class="ai-chart-header">
                  <i class="fas fa-chart-line"></i>
                  Wheat Price History - 90 Days
                </div>
                <div class="chart-area"><canvas id="wheatPriceChart"></canvas></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Data sources selection -->
        <div class="ai-message" id="sourcesMessage" style="display: none;">
          <div class="ai-avatar">
            <i class="fas fa-database"></i>
          </div>
          <div class="ai-content">
            <div class="ai-bubble ai-loading" id="sourcesLoading" style="display: none;">
              <div class="ai-spinner"></div>
              <p>Identifying relevant data sources...</p>
            </div>
            
            <div id="sourcesList" style="display: none;" class="ai-sources-list">
              <div class="ai-bubble">
                <p>Selected data sources:</p>
              </div>
              <div class="ai-data-sources">
                <!-- Data sources will be added dynamically -->
              </div>
            </div>
          </div>
        </div>

        <!-- Data extraction -->
        <div class="ai-message" id="analysisMessage" style="display: none;">
          <div class="ai-avatar">
            <i class="fas fa-brain"></i>
          </div>
          <div class="ai-content">
            <div class="ai-bubble ai-loading" id="analysisLoading" style="display: none;">
              <div class="ai-spinner"></div>
              <p>Extracting and analyzing sources...</p>
              <div class="ai-progress">
                <div class="ai-progress-bar"></div>
              </div>
            </div>
            
            <div id="analysisFindings" style="display: none;">
              <div class="ai-bubble">
                <p class="font-medium">
                  I have collected and analyzed the sources. Here's what I found:
                </p>
              </div>
              
              <div class="ai-findings">
                <div class="ai-finding" style="animation-delay: 0.1s;">
                  <i class="fas fa-arrow-right"></i>
                  <div class="ai-finding-content">
                    <p>Price Projection</p>
                    <p>Expected increase of 18-22% within 90 days.</p>
                  </div>
                </div>
                <div class="ai-finding" style="animation-delay: 0.5s;">
                  <i class="fas fa-arrow-right"></i>
                  <div class="ai-finding-content">
                    <p>Supply Chain Impact</p>
                    <p>Moderate risk of disruption for the next 3 months.</p>
                  </div>
                </div>
                <div class="ai-finding" style="animation-delay: 0.7s;">
                  <i class="fas fa-arrow-right"></i>
                  <div class="ai-finding-content">
                    <p>Market Volatility</p>
                    <p>Expected 35% increase in price volatility.</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Scenarios -->
        <div class="ai-message" id="scenariosMessage" style="display: none;">
          <div class="ai-avatar">
            <i class="fas fa-sparkles"></i>
          </div>
          <div class="ai-content">
            <div class="ai-bubble">
              <p class="font-medium">
                Based on these findings, Cegid Business Insights had identified potential actions:
              </p>
            </div>
            
            <div class="ai-scenarios">
              <div class="ai-scenario-card scenario-1" data-scenario="1" style="animation-delay: 0.1s;">
                <div class="ai-card-header">
                  <div class="ai-card-icon">
                    <i class="fas fa-file-lines"></i>
                  </div>
                  <div class="ai-card-title">Adjust Financial Forecasts in Cegid Exabanque</div>
                </div>
                <div class="ai-card-content">
                  <div class="ai-card-impact">Forecast balance alignment with new cost projections</div>
                  <div class="ai-card-description">Would you like to adjust the related forecasts in Cegid Exabanque?</div>
                </div>
                <div class="ai-card-footer">
                  <button class="ai-action-btn scenario-action">
                    <i class="fas fa-file-lines"></i>
                    <span>Update the forecasts</span>
                  </button>
                  <div class="ai-action-state loading" style="display: none;">
                    <i class="fas fa-spinner"></i>
                    <span>Executing action...</span>
                  </div>
                  <div class="ai-action-state success" style="display: none;">
                    <i class="fas fa-check-circle"></i>
                    <span>Action executed</span>
                  </div>
                </div>
              </div>
              
              <div class="ai-scenario-card scenario-2" data-scenario="2" style="animation-delay: 0.3s;">
                <div class="ai-card-header">
                  <div class="ai-card-icon">
                    <i class="fas fa-chart-bar"></i>
                  </div>
                  <div class="ai-card-title">Update Aging Balance in Cegid XRP Flex</div>
                </div>
                <div class="ai-card-content">
                  <div class="ai-card-impact">Preparation for expected cost increase</div>
                  <div class="ai-card-description">Would you like to update the aging balance in Cegid XRP Flex?</div>
                </div>
                <div class="ai-card-footer">
                  <button class="ai-action-btn scenario-action">
                    <i class="fas fa-chart-bar"></i>
                    <span>Update aging balance</span>
                  </button>
                  <div class="ai-action-state loading" style="display: none;">
                    <i class="fas fa-spinner"></i>
                    <span>Executing action...</span>
                  </div>
                  <div class="ai-action-state success" style="display: none;">
                    <i class="fas fa-check-circle"></i>
                    <span>Action executed</span>
                  </div>
                </div>
              </div>
          </div>
        </div>

        
      </div>
      <!-- Action confirmation -->
      <div class="ai-message" id="confirmationMessage" style="display: none;">
        <div class="ai-avatar">
          <i class="fas fa-check-circle"></i>
        </div>
        <div class="ai-content">            
          <div class="ai-summary" id="summary" style="display: none;">
            <p class="font-medium">
              You are currently not a Cegid XRP Flex subscriber.
            </p>
            <p class="mt-1">
              Please contact the sales team at +33 800 73 00 79. We look forward to helping you discover how Cegid XRP Flex can meet your business needs.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Modal Footer -->
  <div class="ai-modal-footer">
    <div class="ai-footer-status" id="footerDefault">
      <span>Powered by Cegid Pulse</span>
    </div>
    <div class="ai-footer-status success" id="footerSuccess" style="display: none;">
      <i class="fas fa-check-circle"></i>
      <span>Action completed successfully</span>
    </div>
    <button id="aiCloseBtn" class="btn-primary">Close</button>
  </div>
</div>